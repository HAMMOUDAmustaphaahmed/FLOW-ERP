{% extends "base.html" %}

{% block title %}Gestion de la Paie - FlowERP{% endblock %}

{% block extra_css %}
<style>
.payroll-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
}

.tabs-container {
    background: var(--bg-primary);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-md);
    overflow: hidden;
    margin-bottom: 2rem;
}

.tabs {
    display: flex;
    background: var(--bg-tertiary);
    border-bottom: 2px solid var(--border-color);
    overflow-x: auto;
}

.tab {
    flex: 1;
    padding: 1rem 1.5rem;
    text-align: center;
    cursor: pointer;
    border: none;
    background: transparent;
    font-weight: 600;
    color: var(--text-secondary);
    transition: all var(--transition-fast);
    position: relative;
    white-space: nowrap;
}

.tab:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

.tab.active {
    color: var(--primary-color);
    background: var(--bg-primary);
}

.tab.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--primary-color);
}

.tab-content {
    display: none;
    padding: 2rem;
}

.tab-content.active {
    display: block;
}

/* Effet de flou pour les salaires - Style Glassmorphism */
.salary-blur {
    position: relative;
    transition: all 0.3s ease;
}

.salary-blur::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: white;
    opacity: 1;
    z-index: 5;
}

.salary-blur::after {
    content: 'üëÅÔ∏è Cliquer pour afficher';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
    font-size: 0.9rem;
    font-weight: 600;
    color: #667eea;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    white-space: nowrap;
    pointer-events: none;
}

@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.95;
    }
}

.salary-blur .salary-item {
    pointer-events: none;
}

.salary-details:not(.salary-blur) {
    filter: none;
}

.salary-details {
    transition: all 0.3s ease;
}

.employee-card {
    position: relative;
}

.config-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.config-card {
    background: var(--bg-tertiary);
    padding: 1.5rem;
    border-radius: var(--border-radius);
    border: 2px solid var(--border-color);
}

.config-card h3 {
    margin-bottom: 1rem;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.config-card h3 i {
    color: var(--primary-color);
}

.form-group {
    margin-bottom: 1rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--text-primary);
}

.form-input {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    background: var(--bg-primary);
    color: var(--text-primary);
    transition: all var(--transition-fast);
}

.form-input:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.employee-salary-grid {
    display: grid;
    gap: 1rem;
}

.employee-card {
    background: var(--bg-primary);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    transition: all var(--transition-fast);
}

.employee-card:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
}

.employee-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.employee-info {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.employee-avatar {
    width: 48px;
    height: 48px;
    border-radius: var(--border-radius-full);
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
}

.salary-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
}

.salary-item {
    padding: 0.75rem;
    background: var(--bg-tertiary);
    border-radius: var(--border-radius);
}

.salary-item label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-secondary);
    text-transform: uppercase;
    margin-bottom: 0.25rem;
}

.salary-item .value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
}

.requests-table {
    width: 100%;
    border-collapse: collapse;
}

.requests-table thead {
    background: var(--bg-tertiary);
}

.requests-table th {
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--border-color);
}

.requests-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
}

.requests-table tbody tr:hover {
    background: var(--bg-tertiary);
}

.badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: var(--border-radius);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.badge.pending {
    background: #fef3c7;
    color: #92400e;
}

.badge.approved {
    background: #d1fae5;
    color: #065f46;
}

.badge.rejected {
    background: #fee2e2;
    color: #991b1b;
}

.badge.paid {
    background: #dbeafe;
    color: #1e40af;
}

.badge.draft {
    background: #f3f4f6;
    color: #374151;
}

.badge.validated {
    background: #d1fae5;
    color: #065f46;
}

.badge.annual {
    background: #e0e7ff;
    color: #3730a3;
}

.badge.sick {
    background: #fce7f3;
    color: #831843;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: var(--border-radius);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.btn-success {
    background: #10b981;
    color: white;
}

.btn-success:hover {
    background: #059669;
}

.btn-danger {
    background: #ef4444;
    color: white;
}

.btn-danger:hover {
    background: #dc2626;
}

.btn-secondary {
    background: var(--bg-tertiary);
    color: var(--text-primary);
    border: 2px solid var(--border-color);
}

.btn-secondary:hover {
    background: var(--bg-secondary);
    border-color: var(--primary-color);
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(6px);
}

.modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: var(--bg-primary);
    border-radius: var(--border-radius-lg);
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-xl);
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 2px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bg-tertiary);
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 700;
}

.modal-close {
    background: transparent;
    border: none;
    font-size: 1.75rem;
    cursor: pointer;
    color: var(--text-secondary);
    padding: 0.5rem;
    border-radius: var(--border-radius);
    transition: all var(--transition-fast);
}

.modal-close:hover {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
}

.modal-body {
    padding: 2rem;
}

.modal-footer {
    padding: 1.5rem;
    border-top: 2px solid var(--border-color);
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    background: var(--bg-tertiary);
}

.payslip-preview {
    background: white;
    padding: 2rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    color: #000;
}

.payslip-header {
    text-align: center;
    border-bottom: 2px solid #000;
    padding-bottom: 1rem;
    margin-bottom: 1rem;
}

.payslip-section {
    margin-bottom: 1.5rem;
}

.payslip-table {
    width: 100%;
    border-collapse: collapse;
}

.payslip-table td {
    padding: 0.5rem;
    border-bottom: 1px solid #ddd;
}

.payslip-table td:first-child {
    font-weight: 600;
}

.payslip-table td:last-child {
    text-align: right;
}

.payslip-total {
    background: #f0f0f0;
    font-weight: 700;
    font-size: 1.1rem;
}

.filter-bar {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.filter-bar select,
.filter-bar input {
    flex: 1;
    min-width: 200px;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="payroll-header">
    <div>
        <h1>üí∞ Gestion de la Paie</h1>
        <p class="text-secondary">Configuration des salaires, cong√©s, avances et fiches de paie</p>
    </div>
    <button class="btn btn-primary" onclick="openGenerateAllPayslipsModal()">
        <i class="fas fa-file-invoice"></i> G√©n√©rer toutes les fiches
    </button>
</div>

<div class="tabs-container">
    <div class="tabs">
        <button class="tab active" onclick="switchTab('employees')">
            <i class="fas fa-users"></i> Employ√©s
        </button>
        <button class="tab" onclick="switchTab('salaries')">
            <i class="fas fa-money-bill-wave"></i> Salaires
        </button>
        <button class="tab" onclick="switchTab('leaves')">
            <i class="fas fa-calendar-alt"></i> Cong√©s
        </button>
        <button class="tab" onclick="switchTab('advances')">
            <i class="fas fa-hand-holding-usd"></i> Avances
        </button>
        <button class="tab" onclick="switchTab('payslips')">
            <i class="fas fa-file-invoice-dollar"></i> Fiches de Paie
        </button>
        <button class="tab" onclick="switchTab('config')">
            <i class="fas fa-cog"></i> Configuration
        </button>
    </div>

    <!-- Tab: Employ√©s -->
    <div id="employees-tab" class="tab-content active">
        <h3>Liste des Employ√©s</h3>
        <table class="requests-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Pr√©nom</th>
                    <th>Nom</th>
                    <th>T√©l√©phone</th>
                    <th>Email</th>
                    <th>Date de cr√©ation</th>
                    <th>D√©partement</th>
                </tr>
            </thead>
            <tbody id="employeesBody">
                <tr>
                    <td colspan="7" style="text-align: center; padding: 2rem;">
                        Chargement...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Tab: Salaires -->
    <div id="salaries-tab" class="tab-content">
        <div class="filter-bar">
            <input type="text" id="salarySearch" class="form-input" placeholder="Rechercher un employ√©...">
            <select id="salaryDepartmentFilter" class="form-input">
                <option value="">Tous les d√©partements</option>
            </select>
            <button class="btn btn-sm btn-secondary" onclick="toggleAllSalaries()">
                <i class="fas fa-eye"></i> Afficher tout
            </button>
        </div>

        <div id="employeeSalaryList" class="employee-salary-grid">
            <!-- Charg√© dynamiquement -->
        </div>
    </div>

<div id="leaves-tab" class="tab-content">
    <div class="filter-bar">
        <!-- üîç RECHERCHE DYNAMIQUE -->
        <div class="search-box" style="flex: 2;">
            <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #6b7280;"></i>
            <input 
                type="text" 
                id="leaveSearchInput" 
                class="form-input" 
                placeholder="Rechercher par nom, pr√©nom, email..."
                style="padding-left: 2.5rem;"
            >
        </div>
        
        <!-- Filtres -->
        <select id="leaveStatusFilter" class="form-input" onchange="loadLeaveRequests()">
            <option value="">Tous les statuts</option>
            <option value="pending">En attente</option>
            <option value="approved" selected>Approuv√©</option>
            <option value="rejected">Rejet√©</option>
        </select>
        
        <select id="leaveTypeFilter" class="form-input" onchange="loadLeaveRequests()">
            <option value="">Tous les types</option>
            <option value="annual">Cong√© annuel</option>
            <option value="sick">Cong√© maladie</option>
            <option value="unpaid">Cong√© sans solde</option>
            <option value="maternity">Cong√© maternit√©</option>
        </select>
        
        <!-- üìÖ FILTRES DE DATE (MOIS ACTUEL PAR D√âFAUT) -->
        <select id="leaveMonthFilter" class="form-input" onchange="loadLeaveRequests()">
            <option value="">Tous les mois</option>
            <option value="1">Janvier</option>
            <option value="2">F√©vrier</option>
            <option value="3">Mars</option>
            <option value="4">Avril</option>
            <option value="5">Mai</option>
            <option value="6">Juin</option>
            <option value="7">Juillet</option>
            <option value="8">Ao√ªt</option>
            <option value="9">Septembre</option>
            <option value="10">Octobre</option>
            <option value="11">Novembre</option>
            <option value="12">D√©cembre</option>
        </select>
        
        <select id="leaveYearFilter" class="form-input" onchange="loadLeaveRequests()">
            <option value="">Toutes les ann√©es</option>
        </select>
        
        <!-- Bouton reset -->
        <button class="btn btn-sm btn-secondary" onclick="resetLeaveFilters()">
            <i class="fas fa-redo"></i> R√©initialiser
        </button>
    </div>

    <table class="requests-table">
        <thead>
            <tr>
                <th>Employ√©</th>
                <th>Type</th>
                <th>P√©riode</th>
                <th>Jours</th>
                <th>Statut</th>
                <th>D√©duction</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="leaveRequestsBody">
            <tr>
                <td colspan="7" style="text-align: center; padding: 2rem;">
                    Chargement...
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Tab: Avances - AVEC RECHERCHE ET FILTRES -->
<div id="advances-tab" class="tab-content">
    <div class="filter-bar">
        <!-- üîç RECHERCHE DYNAMIQUE -->
        <div class="search-box" style="flex: 2;">
            <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #6b7280;"></i>
            <input 
                type="text" 
                id="advanceSearchInput" 
                class="form-input" 
                placeholder="Rechercher par nom, pr√©nom, email..."
                style="padding-left: 2.5rem;"
            >
        </div>
        
        <select id="advanceStatusFilter" class="form-input" onchange="loadAdvances()">
            <option value="">Tous les statuts</option>
            <option value="pending">En attente</option>
            <option value="approved" selected>Approuv√©</option>
            <option value="rejected">Rejet√©</option>
            <option value="repaid">Rembours√©</option>
        </select>
        
        <!-- üìÖ FILTRES DE DATE -->
        <select id="advanceMonthFilter" class="form-input" onchange="loadAdvances()">
            <option value="">Tous les mois</option>
            <option value="1">Janvier</option>
            <option value="2">F√©vrier</option>
            <option value="3">Mars</option>
            <option value="4">Avril</option>
            <option value="5">Mai</option>
            <option value="6">Juin</option>
            <option value="7">Juillet</option>
            <option value="8">Ao√ªt</option>
            <option value="9">Septembre</option>
            <option value="10">Octobre</option>
            <option value="11">Novembre</option>
            <option value="12">D√©cembre</option>
        </select>
        
        <select id="advanceYearFilter" class="form-input" onchange="loadAdvances()">
            <option value="">Toutes les ann√©es</option>
        </select>
        
        <button class="btn btn-sm btn-secondary" onclick="resetAdvanceFilters()">
            <i class="fas fa-redo"></i> R√©initialiser
        </button>
    </div>

    <table class="requests-table">
        <thead>
            <tr>
                <th>Employ√©</th>
                <th>Montant</th>
                <th>Remboursement</th>
                <th>Restant</th>
                <th>Statut</th>
                <th>Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="advancesBody">
            <tr>
                <td colspan="7" style="text-align: center; padding: 2rem;">
                    Chargement...
                </td>
            </tr>
        </tbody>
    </table>
</div>

<!-- Tab: Fiches de Paie - AVEC RECHERCHE ET FILTRES -->
<div id="payslips-tab" class="tab-content">
    <div class="filter-bar">
        <!-- üîç RECHERCHE DYNAMIQUE -->
        <div class="search-box" style="flex: 2;">
            <i class="fas fa-search" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #6b7280;"></i>
            <input 
                type="text" 
                id="payslipSearchInput" 
                class="form-input" 
                placeholder="Rechercher par nom, pr√©nom, email..."
                style="padding-left: 2.5rem;"
            >
        </div>
        
        <select id="payslipMonth" class="form-input" onchange="loadPayslips()">
            <option value="">Tous les mois</option>
            <option value="1">Janvier</option>
            <option value="2">F√©vrier</option>
            <option value="3">Mars</option>
            <option value="4">Avril</option>
            <option value="5">Mai</option>
            <option value="6">Juin</option>
            <option value="7">Juillet</option>
            <option value="8">Ao√ªt</option>
            <option value="9">Septembre</option>
            <option value="10">Octobre</option>
            <option value="11">Novembre</option>
            <option value="12">D√©cembre</option>
        </select>
        
        <select id="payslipYear" class="form-input" onchange="loadPayslips()">
            <option value="">Toutes les ann√©es</option>
        </select>
        
        <select id="payslipStatusFilter" class="form-input" onchange="loadPayslips()">
            <option value="">Tous les statuts</option>
            <option value="draft">Brouillon</option>
            <option value="validated">Valid√©</option>
            <option value="paid">Pay√©</option>
        </select>
        
        <button class="btn btn-sm btn-secondary" onclick="resetPayslipFilters()">
            <i class="fas fa-redo"></i> R√©initialiser
        </button>
    </div>

    <table class="requests-table">
        <thead>
            <tr>
                <th>Employ√©</th>
                <th>P√©riode</th>
                <th>Brut</th>
                <th>D√©ductions</th>
                <th>Net</th>
                <th>Statut</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="payslipsBody">
            <tr>
                <td colspan="7" style="text-align: center; padding: 2rem;">
                    Chargement...
                </td>
            </tr>
        </tbody>
    </table>
</div>

<style>
/* Styles pour la barre de recherche et filtres */
.filter-bar {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    align-items: center;
}

.search-box {
    position: relative;
    flex: 1;
    min-width: 250px;
}

.filter-bar select,
.filter-bar input {
    flex: 1;
    min-width: 150px;
}

/* Highlight pour r√©sultats de recherche */
mark {
    background: #fef08a;
    padding: 0 2px;
    border-radius: 2px;
    font-weight: 600;
}

/* Animation pour chargement */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.requests-table tbody tr {
    animation: fadeIn 0.3s ease;
}
</style>

<script>
// Fonctions de r√©initialisation des filtres

function resetLeaveFilters() {
    document.getElementById('leaveSearchInput').value = '';
    document.getElementById('leaveStatusFilter').value = 'approved';
    document.getElementById('leaveTypeFilter').value = '';
    document.getElementById('leaveMonthFilter').value = new Date().getMonth() + 1;
    document.getElementById('leaveYearFilter').value = new Date().getFullYear();
    currentFilters.search = '';
    loadLeaveRequests();
}

function resetAdvanceFilters() {
    document.getElementById('advanceSearchInput').value = '';
    document.getElementById('advanceStatusFilter').value = 'approved';
    document.getElementById('advanceMonthFilter').value = new Date().getMonth() + 1;
    document.getElementById('advanceYearFilter').value = new Date().getFullYear();
    currentFilters.search = '';
    loadAdvances();
}

function resetPayslipFilters() {
    document.getElementById('payslipSearchInput').value = '';
    document.getElementById('payslipMonth').value = new Date().getMonth() + 1;
    document.getElementById('payslipYear').value = new Date().getFullYear();
    document.getElementById('payslipStatusFilter').value = '';
    currentFilters.search = '';
    loadPayslips();
}
</script>
    <!-- Tab: Configuration -->
    <div id="config-tab" class="tab-content">
        <div class="config-grid">
            <div class="config-card">
                <h3><i class="fas fa-briefcase"></i> Jours de Travail</h3>
                <div class="form-group">
                    <label>Jours par semaine</label>
                    <input type="number" id="workingDaysPerWeek" class="form-input" min="1" max="7">
                </div>
                <div class="form-group">
                    <label>Heures par jour</label>
                    <input type="number" id="workingHoursPerDay" class="form-input" min="1" max="24" step="0.5">
                </div>
                <div class="form-group">
                    <label>Jours par mois (moyens)</label>
                    <input type="number" id="workingDaysPerMonth" class="form-input" min="1" max="31">
                </div>
            </div>

            <div class="config-card">
                <h3><i class="fas fa-percent"></i> Cotisations Sociales</h3>
                <div class="form-group">
                    <label>CNSS Employ√© (%)</label>
                    <input type="number" id="cnssRate" class="form-input" min="0" max="100" step="0.01">
                </div>
                <div class="form-group">
                    <label>CNSS Employeur (%)</label>
                    <input type="number" id="cnssEmployerRate" class="form-input" min="0" max="100" step="0.01">
                </div>
                <div class="form-group">
                    <label>IRPP (%)</label>
                    <input type="number" id="irppRate" class="form-input" min="0" max="100" step="0.01">
                    <small class="text-secondary">Taux de base (calcul progressif)</small>
                </div>
            </div>

            <div class="config-card">
                <h3><i class="fas fa-umbrella-beach"></i> Cong√©s Annuels</h3>
                <div class="form-group">
                    <label>Jours de cong√©s annuels</label>
                    <input type="number" id="annualLeaveDays" class="form-input" min="0" max="365">
                </div>
                <div class="form-group">
                    <label>Jours de cong√©s maladie</label>
                    <input type="number" id="sickLeaveDays" class="form-input" min="0" max="365">
                </div>
            </div>

            <div class="config-card">
                <h3><i class="fas fa-exclamation-triangle"></i> P√©nalit√©s</h3>
                <div class="form-group">
                    <label>P√©nalit√© absence (% salaire journalier)</label>
                    <input type="number" id="absencePenaltyRate" class="form-input" min="0" max="100" step="0.1">
                </div>
                <div class="form-group">
                    <label>P√©nalit√© retard (% salaire horaire)</label>
                    <input type="number" id="latePenaltyRate" class="form-input" min="0" max="100" step="0.1">
                </div>
            </div>
        </div>

        <button class="btn btn-primary" onclick="saveConfig()">
            <i class="fas fa-save"></i> Enregistrer la Configuration
        </button>
    </div>
</div>

<!-- Modal: Modifier Salaire -->
<div id="salaryModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Modifier le Salaire</h2>
            <button class="modal-close" onclick="closeSalaryModal()">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="salaryUserId">
            <div class="form-group">
                <label>Salaire de Base (TND)</label>
                <input type="number" id="baseSalary" class="form-input" step="0.001">
            </div>
            <div class="form-group">
                <label>Prime Transport (TND)</label>
                <input type="number" id="transportAllowance" class="form-input" step="0.001">
            </div>
            <div class="form-group">
                <label>Prime Panier (TND)</label>
                <input type="number" id="foodAllowance" class="form-input" step="0.001">
            </div>
            <div class="form-group">
                <label>Prime Logement (TND)</label>
                <input type="number" id="housingAllowance" class="form-input" step="0.001">
            </div>
            <div class="form-group">
                <label>Prime Responsabilit√© (TND)</label>
                <input type="number" id="responsibilityBonus" class="form-input" step="0.001">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeSalaryModal()">Annuler</button>
            <button class="btn btn-primary" onclick="saveSalary()">
                <i class="fas fa-save"></i> Enregistrer
            </button>
        </div>
    </div>
</div>

<!-- Modal: Traiter Cong√© -->
<div id="leaveReviewModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Traiter la Demande de Cong√©</h2>
            <button class="modal-close" onclick="closeLeaveReviewModal()">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="leaveRequestId">
            <div id="leaveRequestDetails"></div>
            <div class="form-group">
                <label>Commentaire</label>
                <textarea id="leaveReviewComment" class="form-input" rows="3"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeLeaveReviewModal()">Annuler</button>
            <button class="btn btn-danger" onclick="reviewLeaveRequest('rejected')">
                <i class="fas fa-times"></i> Rejeter
            </button>
            <button class="btn btn-success" onclick="reviewLeaveRequest('approved')">
                <i class="fas fa-check"></i> Approuver
            </button>
        </div>
    </div>
</div>

<!-- Modal: Traiter Avance -->
<div id="advanceReviewModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">Traiter la Demande d'Avance</h2>
            <button class="modal-close" onclick="closeAdvanceReviewModal()">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="advanceId">
            <div id="advanceDetails"></div>
            <div class="form-group">
                <label>Date de versement</label>
                <input type="date" id="disbursementDate" class="form-input">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeAdvanceReviewModal()">Annuler</button>
            <button class="btn btn-danger" onclick="reviewAdvance('rejected')">
                <i class="fas fa-times"></i> Rejeter
            </button>
            <button class="btn btn-success" onclick="reviewAdvance('approved')">
                <i class="fas fa-check"></i> Approuver
            </button>
        </div>
    </div>
</div>

<!-- Modal: G√©n√©rer Fiche de Paie -->
<div id="generatePayslipModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title">G√©n√©rer Fiche de Paie</h2>
            <button class="modal-close" onclick="closeGeneratePayslipModal()">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="generateUserId">
            <div class="form-group">
                <label>Mois</label>
                <select id="generateMonth" class="form-input">
                    <option value="1">Janvier</option>
                    <option value="2">F√©vrier</option>
                    <option value="3">Mars</option>
                    <option value="4">Avril</option>
                    <option value="5">Mai</option>
                    <option value="6">Juin</option>
                    <option value="7">Juillet</option>
                    <option value="8">Ao√ªt</option>
                    <option value="9">Septembre</option>
                    <option value="10">Octobre</option>
                    <option value="11">Novembre</option>
                    <option value="12">D√©cembre</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ann√©e</label>
                <select id="generateYear" class="form-input"></select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeGeneratePayslipModal()">Annuler</button>
            <button class="btn btn-primary" onclick="generatePayslip()">
                <i class="fas fa-file-invoice"></i> G√©n√©rer
            </button>
        </div>
    </div>
</div>

<!-- Modal: Aper√ßu Fiche de Paie -->
<div id="payslipPreviewModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2 class="modal-title">Fiche de Paie</h2>
            <button class="modal-close" onclick="closePayslipPreviewModal()">√ó</button>
        </div>
        <div class="modal-body">
            <div id="payslipPreviewContent"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closePayslipPreviewModal()">Fermer</button>
            <button class="btn btn-primary" onclick="downloadPayslipPDF()">
                <i class="fas fa-download"></i> T√©l√©charger PDF
            </button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/payroll.js') }}"></script>
{% endblock %}